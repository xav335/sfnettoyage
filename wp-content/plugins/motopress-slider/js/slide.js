(function(d,c){c.Core={SliderManager:{}};c.Workground=can.Control.extend({defaults:{},width:null,height:null},{layers:[],current:null,layerControls:{},sliderWrapper:null,sliderBgWrapper:null,sliderContainer:null,sliderEl:null,slide:null,slideControl:null,slideBg:null,addButtons:null,deleteButtons:null,slideApi:null,init:function(a,b){this.layerControls=new c.LayerControls(".mpsl-layers-list-child-wrapper");this.layerControls.linkWorkground(this);this.sliderWrapper=a.children(".mpsl-slider-wrapper");
this.sliderContainer=this.sliderWrapper.children(".motoslider_wrapper");this.addButtons=a.find(".mpsl-layer-control-panel .mpsl-add-layer");this.deleteButtons=a.find('.mpsl-layer-control-panel [class*="mpsl-delete-"]');var f=c.Functions.getScrollbarWidth();this.initControls();var g=this;this.sliderContainer.one("MPSliderLoad",function(){c.Core.SliderManager=MPSLManager.getSliderManager(g.sliderContainer[0]);g.sliderBgWrapper=g.sliderWrapper.children(".mpsl-slide-bg-wrapper");g.sliderEl=g.sliderContainer.children(".ms_wrapper");
g.slide=g.sliderEl.find(".ms_current_slide");g.slideApi=c.Core.SliderManager.getSlide(g.slide[0]);g.slideBg=g.slide.children(".ms_slide_wrapper");c.Workground.width=g.sliderEl.outerWidth();c.Workground.height=g.sliderEl.outerHeight();g.sliderBgWrapper.css({"min-width":c.Workground.width,height:c.Workground.height});d(".mpsl-slide-border").css("width",c.Workground.width);g.sliderWrapper.css("max-height",c.Workground.height+f);g.sliderBgWrapper.append(g.slideBg.children().clone());g.initLayers();g.addButtons.removeAttr("disabled");
g.deleteButtons.filter(".mpsl-delete-all-layers").removeAttr("disabled");c.Preloader.stop()})},initControls:function(){var a=this.addButtons.filter('[data-type="image"]');(new c.AddImageML(a,{id:"mpsl-add-image-ml",title:"New Image",button:{text:c.Vars.layer_options.general.options.image_id.select_label}})).linkWokground(this)},updateSlideBg:function(){this.sliderBgWrapper.html(this.slide.children(".ms_slide_wrapper").children().clone())},'.mpsl-layer-control-panel .mpsl-add-layer:not([data-type="image"]) click':function(a){c.Preloader.start(d(".mpsl-slider-wrapper"));
var b=this,f=null,g=null,l={options:{}};switch(a.attr("data-type")){case "html":l.options={type:"html",text:"lorem ipsum",html_style:""};f=c.HtmlLayer.create(l);break;case "button":l.options={button_text:"Button",button_link:c.Vars.layer_defaults.button_link,button_target:c.Vars.layer_defaults.button_target,button_style:""};f=c.ButtonLayer.create(l);break;case "video":l.options={video_type:"youtube",youtube_src:"https://www.youtube.com/watch?v=t0jFJmTDqno",youtube_thumbnail:"https://i.ytimg.com/vi/t0jFJmTDqno/maxresdefault.jpg",
video_preview_image:"",video_youtube_hide_controls:!1,video_width:427,video_height:240},f=c.VideoLayer.create(l)}if(f)d(f).one("MPSLLayerCreate",function(){var a=c.Layer.getCentralOffset();g=b.initLayer(d(f));var k=d.extend({},l.options,a);g.updatePosition(a);g.extendOptions(k);g.select();g.control.select();g.control.scrollToElement();b.current=g;c.Preloader.stop(d(".mpsl-slider-wrapper"))})},".mpsl-layer-control-panel .mpsl-delete-layer click":function(){this.remove()},".mpsl-layer-control-panel .mpsl-delete-all-layers click":function(){confirm(c.Vars.lang.layer_want_delete_all)&&
(this.layerControls.removeAll(),this.removeAll(),this.onUnselect())},remove:function(){this.current&&(this.layerControls.remove(this.current.control),this.layers.splice(this.current.getOrder(),1),this.resetOrder(),this.current.api.remove(),this.current=null);this.onUnselect()},removeAll:function(){d.each(this.layers,function(){this.api.remove()});this.layers=[];this.current=null},initLayers:function(){var a=this;this.slide.children(".layers").each(function(){a.initLayer(d(this),!1)})},initLayer:function(a,
b){var f=c.Core.SliderManager.getLayer(a[0]),g=f.getType(),d=f.getOrder(),e=null,k={order:d};if("undefined"!==typeof g&&g){switch(g){case "html":k.type=g;e=new c.HtmlLayer(a,k,b);break;case "button":k.type=g;e=new c.ButtonLayer(a,k,b);break;case "image":k.type=g;e=new c.ImageLayer(a,k,b);break;case "video":k.type="video";k.video_type="html";e=new c.VideoLayer(a,k,b);break;case "youtube":k.type="video";k.video_type="youtube";e=new c.VideoLayer(a,k,b);break;case "vimeo":k.type="video",k.video_type=
"vimeo",e=new c.VideoLayer(a,k,b)}e.linkWorkground(this);e.linkAPI(f);this.layerControls.add(e,d,g+" "+d,{});this.layers.push(e)}return e},setCurrent:function(a){this.current=a},getCurrent:function(){return this.current},getLayersData:function(){return this.layerControls.getData()},onSelect:function(a){this.current=a;this.deleteButtons.filter(".mpsl-delete-layer").removeAttr("disabled")},onUnselect:function(){this.deleteButtons.filter(".mpsl-delete-layer").attr("disabled","disabled");this.current=
null},resetOrder:function(){d.each(this.layers,function(a,b){b.setOrder(a)})},reorder:function(){var a=this;d.each(this.layerControls.controls,function(b,f){a.layers[b]=f.layer;f.layer.setOrder(b)})},".motoslider_wrapper > .ms_wrapper mousedown":function(){d.each(this.layers,function(){this.unselect()});this.onUnselect()}});c.LayerControls=can.Control.extend({defaults:{}},{controls:[],listContainer:null,workground:null,formSettings:{},init:function(a,b){this.element.css("max-height",250-d(".mpsl-layers-table-head").outerHeight());
this.listContainer=a.find(".mpsl-layers-table > tbody");this.makeSortable();this.formSettings=new c.LayerSettingsForm(d(".mpsl-layer-settings-wrapper"),{showErrorType:"internal"})},makeSortable:function(){var a=this;this.listContainer.sortable({handle:".mpsl-layer-drag-handle",scroll:!0,helper:function(a,f){f.children().each(function(){d(this).width(d(this).width())});return f},start:function(a,f){var c=d(f.item).control();c.select();c.layer.select()},update:function(){d(a.listContainer.children("tr").get().reverse()).each(function(b,
f){a.controls[b]=d(f).control();a.controls[b].setOrder(b)});a.workground.reorder()}})},add:function(a,b,f,g){var l=this;"undefined"===typeof g&&(g={});g=d("<tr>");var e=d('<td class="mpsl-layer-drag-handle">').text("");f=d('<td class="mpsl-layer-label">').text(f);g.append(e,f);this.listContainer.prepend(g);f=new c.LayerControl(g);f.on("select",function(a,b){l.formSettings.reinit(b)});f.on("unselect",function(){l.formSettings.hide()});f.setOrder(b);f.linkLayer(a);f.linkLayerControls(this);a.linkControl(f);
this.controls.push(f)},linkWorkground:function(a){this.workground=a},remove:function(a){this.controls.splice(a.getOrder(),1);this.resetOrder();a.element.remove()},removeAll:function(){d.each(this.controls,function(){this.element.remove()});this.controls=[]},resetOrder:function(){d.each(this.controls,function(a,b){b.setOrder(a)})},getData:function(){var a=[];d.each(this.controls,function(b,f){a[f.getOrder()]=f.getData()});return a},updateLayerLabel:function(a,b,f){a=d(this.listContainer.children("tr").get().reverse()[a]).find(".mpsl-layer-label");
var c=a.text().split(" ");c[0]=b;"undefined"!==typeof f&&(c[1]=f);b=c.join(" ");a.text(b)}});c.LayerControl=can.Control.extend({defaults:{}},{layer:null,order:null,layersControls:{},init:function(a,b){},destroy:function(){this.unselect();can.Control.prototype.destroy.call(this)},click:function(a){this.select();this.layer.select()},select:function(){this.element.hasClass("layer-control-selected")||(this.element.siblings().removeClass("layer-control-selected"),this.element.addClass("layer-control-selected"),
this.dispatch("select",[this]))},unselect:function(){this.element.hasClass("layer-control-selected")&&(this.element.removeClass("layer-control-selected"),this.dispatch("unselect",[this]))},linkLayer:function(a){this.layer=a},setOrder:function(a){this.order=a},getOrder:function(){return this.order},getData:function(){return this.layer.options},setOptions:function(a){a.hasOwnProperty("type")&&"video"===a.type&&this.updateLabel("html"===a.video_type?"video":a.video_type);this.layer.setOptions(a);this.layer.render()},
updateLabel:function(a){this.layersControls.updateLayerLabel(this.getOrder(),a)},linkLayerControls:function(a){this.layersControls=a},scrollToElement:function(){this.layersControls.element.animate({scrollTop:this.layersControls.element.scrollTop()+this.element.position().top-this.layersControls.element.position().top-this.layersControls.element.height()/2+this.element.height()/2},100)}});can.extend(c.LayerControl.prototype,can.event);c.Layer=can.Control.extend({defaults:{},create:function(){},getCentralOffset:function(){return{vert_align:c.Vars.layer_defaults.vert_align,
hor_align:c.Vars.layer_defaults.hor_align,offset_x:c.Vars.layer_defaults.offset_x,offset_y:c.Vars.layer_defaults.offset_y}}},{order:null,options:{},control:null,object:null,handle:null,container:null,api:null,workground:null,resizableOptions:{},draggableOptions:{},droppableOptions:{},resizable:!1,isNew:!1,onChangeData:{},storage:{youtubeThumbnails:{},vimeoThumbnails:{}},needReinitFlag:!1,setup:function(a,b,f){this.isNew=f="undefined"!==typeof f?f:!0;this._super(a,b);this.order=b.order;f||"undefined"===
typeof c.Vars.layers[this.order]?d.extend(this.options,b):d.extend(this.options,c.Vars.layers[this.order],b);this.object=a.children();this.container=a.closest(".ms_wrapper")},resetObject:function(){this.object=this.element.children(".ms_layer")},init:function(a,b){this.prepare();this.preventEvents();this.initWidgets();this.initEvents();this.element.on("MPSLLayerChange",this.proxy("onLayerChange"))},reinit:function(){this.resetObject();this.api=c.Core.SliderManager.getLayer(this.element[0]);this.object.addClass("mpsl-layer-child-fix");
this.reprepare();this.preventEvents();this.object.on("MPSLLayerChange",this.proxy("onLayerChange"));this.needReinitFlag=!1},needReinit:function(){this.needReinitFlag=!0},isNeedReinit:function(){return this.needReinitFlag},prepare:function(){this.element.css({left:this.object.position().left,top:this.object.position().top});this.addFixClasses()},addFixClasses:function(){this.element.addClass("mpsl-layer-fix");this.object.addClass("mpsl-layer-child-fix")},addCustomFixClasses:function(){},reprepare:function(){this.addFixClasses();
this.addCustomFixClasses()},initWidgets:function(){this.addHelpers();this.resizable&&this.makeResizable();this.makeDraggable()},addHelpers:function(){this.element.append(d("<div>",{"class":"mpsl-layer-handle",tabindex:1}));this.handle=this.element.children(".mpsl-layer-handle")},makeDraggable:function(){var a=this,b={scroll:!1,grid:[1,1],start:function(){},stop:function(){a.workground.layerControls.formSettings.setOptions(a.getOffsets(),!0)}};this.mergeWidgetOprions(b,this.draggableOptions);this.element.draggable(b);
this.afterMakeDraggable()},makeResizable:function(){var a=this,b={handles:"n, e, s, w, se, sw, ne, nw",minWidth:1,minHeight:1,start:function(){var b=a.object.outerWidth(!0)-a.object.width()+1;"image"===a.api.getType()&&(b+=a.image.outerWidth(!0)-a.image.width());d(this).resizable("option","minWidth",b)},resize:function(){d(this).height(a.object.outerHeight(!0))},stop:function(b,c){a.resizeStop(d(this),b,c)}};this.mergeWidgetOprions(b,this.resizableOptions);this.element.resizable(b);this.afterMakeResizable()},
afterMakeResizable:function(){},afterMakeDraggable:function(){},resizeStop:function(a,b,c){b="image"===this.api.getType()?this.image.width():this.object.width();a=this.getOffsets(c.position.left,c.position.top,b,a.height());a.width=b;this.workground.layerControls.formSettings.setOptions(a,!0);this.updateSize(b)},mergeWidgetOprions:function(a,b){d.each(b,function(b,c){a[b]=c});return a},mousedown:function(a,b){b.stopPropagation();this.select();this.control.select();this.control.scrollToElement()},
select:function(){this.workground.current&&this.workground.current.handle.blur();this.focusWithoutScrolling();this.element.hasClass("layer-selected")||(this.element.siblings(".layers").removeClass("layer-selected"),this.element.addClass("layer-selected"),this.workground.onSelect(this))},unselect:function(){this.workground.current&&this.workground.current.handle.blur();this.element.hasClass("layer-selected")&&(this.element.removeClass("layer-selected"),this.control.unselect())},linkControl:function(a){this.control=
a},getOrder:function(){return this.order},setOrder:function(a){this.order=a;this.element.css("z-index",100+a)},preventEvents:function(){this.object.off("click")},onLayerChange:function(){this.isNeedReinit()&&this.reinit();"image"===this.api.getType()&&this.updateSize(this.onChangeData.width);"video"!==this.api.getType()&&"vimeo"!==this.api.getType()&&"youtube"!==this.api.getType()||this.updateSize(this.onChangeData.width,this.onChangeData.height);this.updatePosition(this.onChangeData.offset);this.onChangeData.widthChanged&&
this.workground.layerControls.formSettings.setOptions(this.getOffsets(),!0);c.Preloader.stop(d(".mpsl-slider-wrapper"))},linkAPI:function(a){this.api=a},linkWorkground:function(a){this.workground=a},setOptions:function(a){a.order=this.order;this.options=a},extendOptions:function(a){d.extend(this.options,a)},render:function(){var a=this;c.Preloader.start(d(".mpsl-slider-wrapper"));var b={},f=null,g=null,l=!1;this.options.hasOwnProperty("width")&&this.object.width()!=parseInt(this.options.width)&&(l=
!0);if(this.options.hasOwnProperty("video_width")&&this.object.width()!=parseInt(this.options.video_width)||this.options.hasOwnProperty("video_height")&&this.object.height()!=parseInt(this.options.video_height))l=!0;var e={},k=[];d.each(this.options,function(l,h){switch(l){case "vert_align":case "hor_align":case "offset_x":case "offset_y":b[l]=h;break;case "text":e.content=h;break;case "html_style":e.hasOwnProperty("classes")&&e.classes.length?e.classes+=" "+h:e.classes=h;break;case "button_text":e.title=
h;break;case "button_style":e.hasOwnProperty("classes")&&e.classes.length?e.classes+=" "+h:e.classes=h;break;case "width":f=h;break;case "image_url":e.src=h;break;case "image_link":e.link=h;break;case "video_type":"youtube"===h&&(e.type="youtube");"vimeo"===h&&(e.type="vimeo");"html"===h&&(e.type="video");a.api.getType()!==e.type&&a.needReinit();break;case "video_src_mp4":e.hasOwnProperty("sources")||(e.sources={});e.sources.mp4=d.trim(h);break;case "video_src_webm":e.hasOwnProperty("sources")||(e.sources=
{});e.sources.webm=d.trim(h);break;case "video_src_ogg":e.hasOwnProperty("sources")||(e.sources={});e.sources.ogg=d.trim(h);break;case "youtube_src":e.src=h;break;case "vimeo_src":e.src=h;break;case "video_width":f=h;break;case "video_height":g=h;break;case "video_html_hide_controls":e.controls=!h;break;case "video_youtube_hide_controls":e.controls=!h;break;case "video_preview_image":if(d.trim(h).length)e.poster=d.trim(h);else switch(a.options.video_type){case "html":e.poster="";break;case "youtube":var m=
d.trim(a.options.youtube_src);if(a.storage.youtubeThumbnails.hasOwnProperty(m))e.poster=a.storage.youtubeThumbnails[m];else{var p=d.Deferred();k.push(p.promise());d.ajax({type:"GET",url:c.Vars.ajax_url,cache:!0,data:{action:"mpsl_get_youtube_thumbnail",nonce:c.Vars.nonces.get_youtube_thumbnail,src:a.options.youtube_src},success:function(b){e.poster=b.result;a.storage.youtubeThumbnails[m]=b.result;p.resolve()},error:function(a){a=d.parseJSON(a.responseText);p.reject(a.message)},dataType:"JSON"})}break;
case "vimeo":if(m=d.trim(a.options.vimeo_src),a.storage.vimeoThumbnails.hasOwnProperty(m))e.poster=a.storage.vimeoThumbnails[m];else{var q=d.Deferred();k.push(q.promise());d.ajax({type:"GET",url:c.Vars.ajax_url,data:{action:"mpsl_get_vimeo_thumbnail",nonce:c.Vars.nonces.get_vimeo_thumbnail,src:a.options.vimeo_src},success:function(b){e.poster=b.result;a.storage.vimeoThumbnails[m]=b.result;q.resolve()},error:function(a){a=d.parseJSON(a.responseText);q.reject(a.message)},dataType:"JSON"})}}break;case "classes":e.hasOwnProperty("classes")&&
e.classes.length?e.classes+=" "+h:e.classes=h;e.classes=d.trim(e.classes);break;case "image_link_classes":e.hasOwnProperty("linkClasses")&&e.linkClasses.length?e.linkClasses+=" "+h:e.linkClasses=h,e.linkClasses=d.trim(e.linkClasses)}});this.onChangeData={widthChanged:l,offset:b,width:f,height:g};-1<d.inArray(this.api.getType(),["button","html"])&&this.element.css({width:"",height:""});d.when.apply(d,k).then(function(){a.api.setOptions(e)},function(a){c.Functions.showMessage(a,c.Functions.MSG_ERROR_TYPE)})},
getOffsets:function(){var a=c.Workground.height/2,b=c.Workground.width/2,f=this.element.position().left,d=this.element.position().top,l=this.element.width(),e=this.element.height(),k={};k.hor_align=this.options.hor_align;k.vert_align=this.options.vert_align;k.offset_x="left"===this.options.hor_align?f:"center"===this.options.hor_align?f+l/2-b:c.Workground.width-f-l;k.offset_y="top"===this.options.vert_align?d:"middle"===this.options.vert_align?d+e/2-a:c.Workground.height-d-e;return k},updatePosition:function(a){var b=
c.Workground.height/2,f=c.Workground.width/2,d=this.element.outerWidth(),l=this.element.outerHeight(),e=l/2,k=d/2,n={};a.offset_x=parseInt(a.offset_x);a.offset_y=parseInt(a.offset_y);n.left="left"===a.hor_align?a.offset_x:"center"===a.hor_align?f-k+a.offset_x:c.Workground.width-d-a.offset_x;n.top="top"===a.vert_align?a.offset_y:"middle"===a.vert_align?b-e+a.offset_y:c.Workground.height-l-a.offset_y;this.element.css(n)},initEvents:function(){var a=this,b,c;this.handle.on("keydown",function(g){b=parseInt(g.keyCode);
if(-1<d.inArray(b,[46,8]))g.preventDefault(),a.workground.remove();else if(-1<d.inArray(b,[37,38,39,40])){g.preventDefault();c=a.element.position();switch(b){case 37:a.element.css("left",c.left-1);break;case 38:a.element.css("top",c.top-1);break;case 39:a.element.css("left",c.left+1);break;case 40:a.element.css("top",c.top+1)}a.workground.layerControls.formSettings.setOptions(a.getOffsets(),!0)}})},focusWithoutScrolling:function(){var a=window.scrollX,b=window.scrollY;this.handle.focus();window.scrollTo(a,
b);this.workground.sliderWrapper.scrollTop(0)}});c.HtmlLayer=c.Layer.extend({defaults:{},prepareOptionsForApi:function(a){var b={position:{}};a.hasOwnProperty("type")&&(b.type=a.type);a.hasOwnProperty("text")&&(b.content=a.text);a.hasOwnProperty("html_style")&&(b.classes=a.html_style);a.hasOwnProperty("vertical_position")&&("top"===a.vertical_position&&a.hasOwnProperty("top")&&(b.position.offsetTop=a.top),"bottom"===a.vertical_position&&a.hasOwnProperty("bottom")&&(b.position.offsetBottom=a.bottom));
a.hasOwnProperty("horizontal_position")&&("left"===a.horizontal_position&&a.hasOwnProperty("left")&&(b.position.offsetLeft=a.left),"right"===a.horizontal_position&&a.hasOwnProperty("right")&&(b.position.offsetRight=a.right));return b},create:function(a){a=c.HtmlLayer.prepareOptionsForApi(a.options);return c.Core.SliderManager.createLayer("html",a)}},{resizable:!1,options:{},setup:function(a,b,c){this._super(a,b,c)},init:function(a,b){this._super(a,b)},afterMakeResizable:function(){this.element.resizable("disable").removeClass("ui-state-disabled")}});
c.ImageLayer=c.Layer.extend({prepareOptionsForApi:function(a){var b={position:{}};a.hasOwnProperty("type")&&(b.type=a.type);a.hasOwnProperty("width")&&(b.width=a.width);a.hasOwnProperty("vertical_position")&&("top"===a.vertical_position&&a.hasOwnProperty("top")&&(b.position.offsetTop=a.top),"bottom"===a.vertical_position&&a.hasOwnProperty("bottom")&&(b.position.offsetBottom=a.bottom));a.hasOwnProperty("horizontal_position")&&("left"===a.horizontal_position&&a.hasOwnProperty("left")&&(b.position.offsetLeft=
a.left),"right"===a.horizontal_position&&a.hasOwnProperty("right")&&(b.position.offsetRight=a.right));return b},create:function(a){var b=c.ImageLayer.prepareOptionsForApi(a.options);b.src=a.src;return c.Core.SliderManager.createLayer("image",b)}},{image:null,resizable:!0,resizableOptions:{aspectRatio:!0,handles:"se, sw, ne, nw",grid:[1,1]},init:function(a,b){this.image=this.object.children();this._super(a,b)},prepare:function(){this._super();var a=this.object[0].getBoundingClientRect();this.element.css("width",
Math.round(a.width));this.addCustomFixClasses()},addCustomFixClasses:function(){this.object.addClass("mpsl-image-layer-child-fix")},updateSize:function(a){if(null!==a){a=parseFloat(a);var b=this.object.outerWidth(!0)-this.object.width(),b=b+(this.image.outerWidth(!0)-this.image.width());this.element.css("width",a+b+"px");this.element.css("height","")}this.object.css("width","100%")}});c.VideoLayer=c.Layer.extend({defaults:{},prepareOptionsForApi:function(a){var b={position:{}};if(a.hasOwnProperty("video_type"))switch(a.video_type){case "youtube":b.type=
"youtube",a.hasOwnProperty("youtube_src")&&(b.src=a.youtube_src),a.hasOwnProperty("video_youtube_hide_controls")&&(b.controls=!a.video_youtube_hide_controls),a.hasOwnProperty("video_preview_image")&&a.video_preview_length?b.poster=a.video_preview_image:a.hasOwnProperty("youtube_thumbnail")?b.poster=a.youtube_thumbnail:b.poster=""}a.hasOwnProperty("video_width")&&(b.width=a.video_width);a.hasOwnProperty("video_height")&&(b.height=a.video_height);a.hasOwnProperty("classes")&&(b.classes=a.classes);a.hasOwnProperty("vertical_position")&&
("top"===a.vertical_position&&a.hasOwnProperty("top")&&(b.position.offsetTop=a.top),"bottom"===a.vertical_position&&a.hasOwnProperty("bottom")&&(b.position.offsetBottom=a.bottom));a.hasOwnProperty("horizontal_position")&&("left"===a.horizontal_position&&a.hasOwnProperty("left")&&(b.position.offsetLeft=a.left),"right"===a.horizontal_position&&a.hasOwnProperty("right")&&(b.position.offsetRight=a.right));return b},create:function(a){a=c.VideoLayer.prepareOptionsForApi(a.options);return c.Core.SliderManager.createLayer(a.type,
a)}},{resizable:!0,resizableOptions:{grid:[1,1]},prepare:function(){this._super();var a=this.object[0].getBoundingClientRect();this.element.css({width:Math.round(a.width),height:Math.round(a.height)});this.addCustomFixClasses()},addCustomFixClasses:function(){this.object.addClass("mpsl-video-layer-child-fix")},resizeStop:function(a,b,c){a=this.object.width();b=this.object.height();c=this.getOffsets();c.video_width=a;c.video_height=b;this.workground.layerControls.formSettings.setOptions(c,!0);this.updateSize(a,
b)},resize:function(a,b,c){a.children("video, iframe").width(c.size.width).height(c.size.height)},updateSize:function(a,b){var c;null!==a&&(a=parseFloat(a),c=this.object.outerWidth(!0)-this.object.width(),this.element.css("width",a+c+"px"));null!==b&&(b=parseFloat(b),c=this.object.outerHeight(!0)-this.object.height(),this.element.css("height",b+c+"px"));this.object.css("width","100%");this.object.css("height","100%")}});c.ButtonLayer=c.Layer.extend({defaults:{},prepareOptionsForApi:function(a){var b=
{position:{}};a.hasOwnProperty("type")&&(b.type=a.type);a.hasOwnProperty("button_text")&&(b.title=a.button_text);a.hasOwnProperty("button_link")&&(b.link=a.button_link);a.hasOwnProperty("button_target")&&(b.target=a.button_target);a.hasOwnProperty("button_style")&&(b.classes=a.button_style);a.hasOwnProperty("vertical_position")&&("top"===a.vertical_position&&a.hasOwnProperty("top")&&(b.position.offsetTop=a.top),"bottom"===a.vertical_position&&a.hasOwnProperty("bottom")&&(b.position.offsetBottom=a.bottom));
a.hasOwnProperty("horizontal_position")&&("left"===a.horizontal_position&&a.hasOwnProperty("left")&&(b.position.offsetLeft=a.left),"right"===a.horizontal_position&&a.hasOwnProperty("right")&&(b.position.offsetRight=a.right));return b},create:function(a){a=c.ButtonLayer.prepareOptionsForApi(a.options);return c.Core.SliderManager.createLayer("button",a)}},{resizable:!1,init:function(a,b){this._super(a,b)},preventEvents:function(){c.Layer.prototype.preventEvents.apply(this,arguments);this.object.attr("href",
"javascript:void(0)").attr("disabled","disabled")},afterMakeResizable:function(){this.element.resizable("disable").removeClass("ui-state-disabled")}});c.LayerSettingsForm=c.FormController.extend({},{optionControllers:{},dependencies:{},layerController:null,optionsContainer:"layer_options",init:function(a,b){this._super(a,b);this.hide()},hide:function(){this.element.addClass("mpsl-hide-options")},show:function(){this.element.removeClass("mpsl-hide-options")},reinit:function(a){var b=this;this.layerController=
a;this.resetOptions();a=d.extend({},c.Vars.layer_defaults,b.layerController.layer.options);d.each(a,function(a,c){"order"!==a&&b.optionControllers.hasOwnProperty(a)&&(b.optionControllers[a].setValue(c,!0),b.showDependencedOptions(a))});this.showAllDependencies();b.layerController.layer.isNew&&(a=this.getOptionsList(),this.layerController.layer.setOptions(a),b.layerController.layer.isNew=!1);this.show()},resetOptions:function(){var a=this;d.each(c.Vars.layer_defaults,function(b,c){a.optionControllers[b].setValue(c,
!0)});this.showAllDependencies()},setOptions:function(a,b){b="undefined"!==typeof b?b:!1;var c=this;d.isPlainObject(a)&&d.each(a,function(a,b){c.optionControllers[a].setValue(b,!0);c.showDependencedOptions(a)});b?this.layerController.layer.setOptions(c.getOptionsList()):this.render()},setType:function(a){this.type=a},render:function(){if(this.verifyOptions()){var a=this.getOptionsList();this.layerController.setOptions(a)}}});c.MediaLibrary=can.Control.extend({defaults:{id:"mpsl-media-library",multiple:!1,
describe:!1,toolbar:"select",sidebar:"settings",content:"upload",router:"browse",menu:"default",searchable:!0,filterable:!1,sortable:!1,title:"tmp Title",button:{text:"tmp Text"},library:{type:"image"},contentUserSetting:!0,syncSelection:!0}},{frame:null,workground:null,init:function(a,b){this.frame=wp.media(b);this.frame.on("open",this.proxy("onOpen"));this.frame.on("select",this.proxy("onSelect"));this.frame.on("close",this.proxy("onClose"))},onOpen:function(){this.frame.reset()},onSelect:function(){var a=
this.frame.state().get("selection").models[0].attributes,b="full",c="full";a.sizes.hasOwnProperty("thumbnail")&&(b="thumbnail");a.sizes.hasOwnProperty("full")?c="full":a.sizes.hasOwnProperty("large")?c="large":a.sizes.hasOwnProperty("medium")?c="medium":a.sizes.hasOwnProperty("thumbnail")&&(c="thumbnail");return{id:a.id,thumbnail:a.sizes[b].url,src:a.sizes[c].url,width:a.width,height:a.height}},onClose:function(){},linkWokground:function(a){this.workground=a},click:function(){this.frame.open()}});
c.AddImageML=c.MediaLibrary.extend({},{onSelect:function(){c.Preloader.start(d(".mpsl-slider-wrapper"));c.Preloader.start(d(".mpsl-layers-list-wrapper"));var a=this,b=this._super();b.options={image_id:b.id};var f=c.Workground.width,g=c.Workground.height,l;l=b.width/b.height;f=f>=g?g/2*l:f/2;f>b.width&&(f=b.width);b.options.width=f;var e=c.ImageLayer.create(b);d(e).one("MPSLLayerCreate",function(){var f=c.Layer.getCentralOffset(),g=a.workground.initLayer(d(e)),h=d.extend({},f,{width:g.element.width(),
image_id:b.id,image_url:b.src});g.updatePosition(f);g.extendOptions(h);g.select();g.control.select();g.control.scrollToElement();a.workground.setCurrent(g);c.Preloader.stop(d(".mpsl-slider-wrapper"));c.Preloader.stop(d(".mpsl-layers-list-wrapper"))})}});c.Preloader=can.Construct({className:".mpsl-preloader",preloaderEl:d('<div class="mpsl-preloader">'),globalPreloaderEl:d(".mpsl-global-preloader"),start:function(a){"undefined"===typeof a?this.globalPreloaderEl.show():a.length&&a.append(this.preloaderEl.clone())},
stop:function(a){"undefined"===typeof a?this.globalPreloaderEl.hide():a.length&&a.children(this.className).remove()}},{});c.SlideFormController=c.FormController.extend({},{workground:null,options:{},dependencies:{},optionsContainer:"options",init:function(a,b){this._super(a,b);d("#mpsl-slide-settings-tabs").tabs()},linkWorkground:function(a){this.workground=a},render:function(a){c.Preloader.start(d(".mpsl-slider-wrapper"));var b={general:{},backgrounds:{}};a="undefined"!==typeof a?a:this.getOptionsList();
a.hasOwnProperty("bg_color_type")&&("color"===a.bg_color_type&&a.hasOwnProperty("bg_color")&&a.bg_color.length&&(b.backgrounds.color={},b.backgrounds.color.color=a.bg_color),"gradient"===a.bg_color_type&&(a.hasOwnProperty("bg_grad_color_1")&&a.bg_grad_color_1.length||a.hasOwnProperty("options.bg_grad_color_2")&&a.bg_grad_color_2.length)&&(b.backgrounds.gradient={},b.backgrounds.gradient.colorInitial=a.hasOwnProperty("bg_grad_color_1")&&a.bg_grad_color_1.length?a.bg_grad_color_1:"#ffffff",b.backgrounds.gradient.colorFinal=
a.hasOwnProperty("bg_grad_color_2")&&a.bg_grad_color_2.length?a.bg_grad_color_2:"#ffffff",a.hasOwnProperty("bg_grad_angle")&&a.bg_grad_angle.length&&(b.backgrounds.gradient.position=a.bg_grad_angle+"deg")),a.hasOwnProperty("bg_image_type")&&(a.hasOwnProperty("bg_internal_image_url")&&a.bg_internal_image_url.length||a.hasOwnProperty("bg_image_url")&&a.bg_image_url.length)&&(b.backgrounds.image={},"library"===a.bg_image_type&&""!==a.bg_internal_image_url&&(b.backgrounds.image.src=a.bg_internal_image_url),
"external"===a.bg_image_type&&""!==a.bg_image_url&&(b.backgrounds.image.src=a.bg_image_url),a.hasOwnProperty("bg_position")&&(b.backgrounds.image.position=a.bg_position),a.hasOwnProperty("bg_position_x")&&(b.backgrounds.image.positionX=a.bg_position_x),a.hasOwnProperty("bg_position_y")&&(b.backgrounds.image.positionY=a.bg_position_y),a.hasOwnProperty("bg_repeat")&&(b.backgrounds.image.repeat=a.bg_repeat),a.hasOwnProperty("bg_fit")&&(b.backgrounds.image.fit=a.bg_fit),a.hasOwnProperty("bg_fit_x")&&
(b.backgrounds.image.fitX=a.bg_fit_x),a.hasOwnProperty("bg_fit_y")&&(b.backgrounds.image.fitY=a.bg_fit_y)),a.hasOwnProperty("slide_classes")&&(b.general.classes=d.trim(a.slide_classes)),a.hasOwnProperty("slide_id")&&(b.general.id=d.trim(a.slide_id)));this.workground.slideApi.setOptions(b);this.workground.updateSlideBg();c.Preloader.stop(d(".mpsl-slider-wrapper"))}});c.SlidePageController=can.Control.extend({},{slideSettingsController:null,workground:null,init:function(a,b){this.workground=new c.Workground("#mpsl-workground",
{});this.slideSettingsController=new c.SlideFormController(".mpsl_options_wrapper");this.slideSettingsController.linkWorkground(this.workground)},disableBtns:function(){this.element.find("#save_slide, #delete_slide").attr("disabled","disabled")},enableBtns:function(){this.element.find("#save_slide, #delete_slide").removeAttr("disabled","disabled")},"#save_slide click":function(a){var b=this;this.disableBtns();a=this.slideSettingsController.getFormData();var f=this.workground.getLayersData();a={action:"mpsl_update_slide",
nonce:c.Vars.nonces.update_slide,options:JSON.stringify(a),layers:JSON.stringify(f)};if(f=c.Vars.attrs.id)a.id=f;d.ajax({type:"POST",url:c.Vars.ajax_url,data:a,success:function(a){b.enableBtns();a.hasOwnProperty("result")&&c.Functions.showMessage(c.Vars.lang.slide_updated,c.Functions.MSG_SUCCESS_TYPE)},error:function(a){a=d.parseJSON(a.responseText);a.debug?console.log(a.message):c.Functions.showMessage(a.message,c.Functions.MSG_ERROR_TYPE);b.enableBtns()},dataType:"JSON"})},"#delete_slide click":function(a){this.disableBtns();
a=c.Vars.attrs.id;if(0==confirm(c.Vars.lang.slide_want_delete_single.replace("%d",a)))return this.enableBtns(),!0;var b={action:"mpsl_delete_slide",nonce:c.Vars.nonces.delete_slide};a&&(b.id=a);d.ajax({type:"POST",url:c.Vars.ajax_url,data:b,success:function(a){deleteBtn.removeAttr("disabled");c.Functions.showMessage(c.Vars.lang.slide_deleted,c.Functions.MSG_SUCCESS_TYPE);a=c.Vars.menu_url;a=c.Functions.addParamToUrl(a,"view","slides");a=c.Functions.addParamToUrl(a,"id",c.Vars.attrs.slider_id);window.location.href=
a},error:function(a){a=d.parseJSON(a.responseText);a.debug?console.log(a.message):c.Functions.showMessage(a.message,c.Functions.MSG_ERROR_TYPE);self.enableBtns()},dataType:"JSON"})}});new c.SlidePageController(d(".mpsl-wrapper"))})(jQuery,MPSL);
